function pixelmatch(r,n,e,t,i){if(r.length!==n.length)throw new Error("Image sizes do not match.");for(var l=0,b=0;b<i;b++)for(var o=0;o<t;o++){var a=4*(b*t+o);if(3521.5*.1<colorDelta(r,n,a,a))e&&drawPixel(e,a,255,0,0),l++;else if(e){var u=grayPixel(r,a,.1);drawPixel(e,a,u,u,u)}}return l}function colorDelta(r,n,e,t,i){var l=r[e+0],b=r[e+1],o=r[e+2],a=r[e+3],u=n[t+0],f=n[t+1],g=n[t+2],c=n[t+3];if(a===c&&l===u&&b===f&&o===g)return 0;a<255&&(l=blend(l,a/=255),b=blend(b,a),o=blend(o,a)),c<255&&(u=blend(u,c/=255),f=blend(f,c),g=blend(g,c));var d=rgb2y(l,b,o)-rgb2y(u,f,g);if(i)return d;var v=rgb2i(l,b,o)-rgb2i(u,f,g),x=rgb2q(l,b,o)-rgb2q(u,f,g);return.5053*d*d+.299*v*v+.1957*x*x}function rgb2y(r,n,e){return.29889531*r+.58662247*n+.11448223*e}function rgb2i(r,n,e){return.59597799*r-.2741761*n-.32180189*e}function rgb2q(r,n,e){return.21147017*r-.52261711*n+.31114694*e}function blend(r,n){return 255+(r-255)*n}function drawPixel(r,n,e,t,i){r[n+0]=e,r[n+1]=t,r[n+2]=i,r[n+3]=255}function grayPixel(r,n,e){return blend(rgb2y(r[n+0],r[n+1],r[n+2]),e*r[n+3]/255)}